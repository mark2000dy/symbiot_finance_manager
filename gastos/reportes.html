<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Reportes - Sistema de Gastos Symbiot</title>
    
    <!-- PWA Configuration -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#191C24">
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" rel="stylesheet">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- SheetJS para exportación a Excel -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.0/package/dist/xlsx.full.min.js"></script>

    <style>
        body {
            background: linear-gradient(135deg, #000 0%, #191C24 50%, #000 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: white;
        }

        /* FIX PARA DROPDOWN MENU Z-INDEX */
        .navbar .dropdown-menu {
            z-index: 9999 !important;
            position: absolute !important;
        }

        .dropdown-menu.show {
            z-index: 9999 !important;
        }

        .welcome-banner {
            z-index: 1 !important;
        }

        /* Fix para dropdown menu z-index */
        .navbar {
            z-index: 1030;
        }

        .dropdown-menu {
            z-index: 1040 !important;
        }

        .welcome-banner {
            z-index: 1000;
        }
        
        .navbar {
            background: rgba(25, 28, 36, 0.95) !important;
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .navbar-brand {
            color: #EB1616 !important;
            font-weight: bold;
            font-size: 1.5rem;
        }
        
        .navbar-nav .nav-link {
            color: rgba(255, 255, 255, 0.8) !important;
            transition: color 0.3s ease;
        }
        
        .navbar-nav .nav-link:hover,
        .navbar-nav .nav-link.active {
            color: #FFA500 !important;
        }
        
        .main-content {
            padding: 2rem 0;
        }

        /* Form labels */
        .form-label {
            color: #E4E6EA !important;
            font-weight: 500;
        }
        
        /* Welcome banner - COLOR NARANJA */
        .welcome-banner {
            background: linear-gradient(135deg, rgba(255, 165, 0, 0.15), rgba(255, 140, 0, 0.1));
            border: 1px solid rgba(255, 165, 0, 0.3);
            border-radius: 15px;
            padding: 2rem;
            margin-bottom: 2rem;
            text-align: center;
            backdrop-filter: blur(10px);
        }
        
        .welcome-banner h4 {
            color: #FFA500;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }
        
        .welcome-banner p {
            color: #E4E6EA;
            margin-bottom: 0;
        }

        /* Stat cards */
        .stat-card {
            background: rgba(25, 28, 36, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            backdrop-filter: blur(10px);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        
        .stat-icon {
            font-size: 2.5rem;
        }

        .stat-card .card-title {
            color: #D0D3D8 !important;
            font-weight: 500;
        }

        .stat-card h4 {
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        /* Cards y widgets */
        .card {
            background: rgba(25, 28, 36, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }

        .card-header {
            background: rgba(255, 165, 0, 0.1);
            border-bottom: 1px solid rgba(255, 165, 0, 0.2);
        }

        .card-header h5, .card-header .h5 {
            color: #FFFFFF !important;
            font-weight: 600;
        }

        /* Botones */
        .btn-primary {
            background-color: #FFA500;
            border-color: #FFA500;
        }

        .btn-primary:hover {
            background-color: #FF8C00;
            border-color: #FF8C00;
        }

        .btn-outline-primary {
            border-color: rgba(255, 165, 0, 0.5);
            color: #FFA500;
        }

        .btn-outline-primary:hover {
            background-color: rgba(255, 165, 0, 0.1);
            border-color: #FFA500;
            color: #FFA500;
        }

        /* Loading spinner */
        .loading-spinner {
            display: inline-block;
        }

        /* Text colors */
        .text-muted, .small {
            color: #E4E6EA !important;
        }

        .text-orange {
            color: #FFA500 !important;
        }

        /* Filters section */
        .filters-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        /* Form controls */
        .form-control, .form-select {
            background-color: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
        }

        .form-control:focus, .form-select:focus {
            background-color: rgba(255, 255, 255, 0.15);
            border-color: #FFA500;
            box-shadow: 0 0 0 0.2rem rgba(255, 165, 0, 0.25);
            color: white;
        }

        .form-control::placeholder {
            color: #9CA3AF;
            opacity: 1;
        }

        .form-select option {
            background-color: #191C24;
            color: white;
        }

        /* Export button */
        .btn-export {
            position: relative;
            overflow: hidden;
        }

        .btn-export:before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .btn-export:hover:before {
            width: 300px;
            height: 300px;
        }
    </style>
    <!-- Theme Toggle CSS -->
    <link rel="stylesheet" href="css/theme-toggle.css?v=1.0.0">
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="dashboard.html">
                <img class="logo-dark" src="assets/images/Symbiot_logo_dark_horizon.png" alt="SYMBIOT Logo" style="height: 30px; margin-right: 8px;">
                <img class="logo-light" src="assets/images/Symbiot_logo_clear_horizon.png" alt="SYMBIOT Logo" style="height: 30px; margin-right: 8px;">
            </a>
            
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item" id="navLinkDashboard">
                        <a class="nav-link" href="dashboard.html">
                            <i class="fas fa-tachometer-alt me-1"></i>Dashboard
                        </a>
                    </li>
                    <li class="nav-item" id="navLinkGastos">
                        <a class="nav-link" href="gastos.html">
                            <i class="fas fa-money-bill-wave me-1"></i>Gastos
                        </a>
                    </li>
                    <li class="nav-item" id="navLinkIngresos">
                        <a class="nav-link" href="ingresos.html">
                            <i class="fas fa-coins me-1"></i>Ingresos
                        </a>
                    </li>
                    <li class="nav-item" id="navLinkReportes">
                        <a class="nav-link active" href="reportes.html">
                            <i class="fas fa-chart-bar me-1"></i>Reportes
                        </a>
                    </li>
                    <li class="nav-item" id="navLinkMaestros" style="display:none;">
                        <a class="nav-link" href="maestros.html">
                            <i class="fas fa-chalkboard-teacher me-1"></i>Maestros
                        </a>
                    </li>
                    <li class="nav-item" id="navLinkPagos" style="display:none;">
                        <a class="nav-link" href="pagos.html">
                            <i class="fas fa-hand-holding-usd me-1"></i>Pagos
                        </a>
                    </li>
                </ul>
                
                <ul class="navbar-nav">
                    <!-- Theme Toggle Button -->
                    <li class="nav-item d-flex align-items-center">
                        <button type="button" id="themeToggleBtn" class="theme-toggle-btn" title="Cambiar tema" aria-label="Cambiar tema">
                            <i class="fas fa-sun"></i>
                        </button>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown">
                            <i class="fas fa-user-circle me-1"></i>
                            <span id="userName">Usuario</span>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li><a class="dropdown-item" href="#" onclick="event.preventDefault(); showUserProfile();"><i class="fas fa-user me-2"></i>Perfil</a></li>
                            <li><a class="dropdown-item" href="configuracion.html"><i class="fas fa-cog me-2"></i>Configuración</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="#" onclick="event.preventDefault(); logout();"><i class="fas fa-sign-out-alt me-2"></i>Cerrar Sesión</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container-fluid main-content">
        <!-- Welcome Banner -->
        <div class="welcome-banner d-flex align-items-center justify-content-between" id="welcomeBanner">
            <div>
                <h4 class="mb-1"><i class="fas fa-file-chart-line me-2"></i>Centro de Reportes</h4>
                <p class="mb-0 text-muted">
                    ¡Bienvenido, <span id="userNameDisplay">Usuario</span>! •
                    <i class="fas fa-building me-1"></i>
                    <span id="userCompany">Cargando...</span> •
                    <span id="currentDate"></span>
                </p>
            </div>
            <img id="companyLogo" src="" alt="Logo empresa" style="height:48px;object-fit:contain;display:none;filter:drop-shadow(0 0 4px rgba(0,0,0,0.4));">
        </div>

        <!-- Alert Container -->
        <div id="alertContainer"></div>

        <!-- Statistics Cards -->
        <div class="row mb-4">
            <!-- Total Reportes Generados -->
            <div class="col-sm-6 col-xl-3 mb-3">
                <div class="card stat-card h-100">
                    <div class="card-body d-flex align-items-center">
                        <i class="fas fa-file-alt stat-icon text-orange me-3"></i>
                        <div>
                            <h6 class="card-title">Reportes Disponibles</h6>
                            <h4 class="text-orange mb-0" id="totalReportes">2</h4>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Periodo Análisis -->
            <div class="col-sm-6 col-xl-3 mb-3">
                <div class="card stat-card h-100">
                    <div class="card-body d-flex align-items-center">
                        <i class="fas fa-calendar-range stat-icon text-info me-3"></i>
                        <div>
                            <h6 class="card-title">Periodo de Análisis</h6>
                            <h4 class="text-info mb-0" id="periodoAnalisis">
                                <span style="font-size: 1rem;">2023-2025</span>
                            </h4>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Total Transacciones -->
            <div class="col-sm-6 col-xl-3 mb-3">
                <div class="card stat-card h-100">
                    <div class="card-body d-flex align-items-center">
                        <i class="fas fa-exchange-alt stat-icon text-success me-3"></i>
                        <div>
                            <h6 class="card-title">Transacciones</h6>
                            <h4 class="text-success mb-0" id="totalTransacciones">
                                <div class="loading-spinner">
                                    <i class="fas fa-spinner fa-spin"></i>
                                </div>
                            </h4>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Última Actualización -->
            <div class="col-sm-6 col-xl-3 mb-3">
                <div class="card stat-card h-100">
                    <div class="card-body d-flex align-items-center">
                        <i class="fas fa-sync-alt stat-icon text-warning me-3"></i>
                        <div>
                            <h6 class="card-title">Última Actualización</h6>
                            <h4 class="text-warning mb-0" id="ultimaActualizacion">
                                <span style="font-size: 0.9rem;">Hoy</span>
                            </h4>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Botón Global de Exportar -->
        <div class="row mb-4">
            <div class="col-12 text-end">
                <button class="btn btn-success btn-export" id="btnExportGlobal" onclick="exportCurrentReport()" disabled>
                    <i class="fas fa-file-excel me-2"></i>Exportar a Excel
                </button>
            </div>
        </div>

        <!-- Filtros Globales -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-filter me-2"></i>Filtros de Reportes
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row filters-section">
                            <div class="col-md-3 mb-3">
                                <label class="form-label">
                                    <i class="fas fa-building me-1"></i>Empresa
                                </label>
                                <select class="form-select" id="filterEmpresa" onchange="applyFilters()">
                                    <option value="">Todas las Empresas</option>
                                    <!-- Se llenarán dinámicamente -->
                                </select>
                            </div>
                            <div class="col-md-3 mb-3">
                                <label class="form-label">
                                    <i class="fas fa-calendar me-1"></i>Año
                                </label>
                                <select class="form-select" id="filterAno" onchange="applyFilters()">
                                    <option value="" selected>Todos los Años</option>
                                    <option value="2023">2023</option>
                                    <option value="2024">2024</option>
                                    <option value="2025">2025</option>
                                    <option value="2026">2026</option>
                                </select>
                            </div>
                            <div class="col-md-3 mb-3">
                                <label class="form-label">
                                    <i class="fas fa-calendar-day me-1"></i>Mes
                                </label>
                                <select class="form-select" id="filterMes" onchange="applyFilters()">
                                    <option value="">Todos los Meses</option>
                                    <option value="01">Enero</option>
                                    <option value="02">Febrero</option>
                                    <option value="03">Marzo</option>
                                    <option value="04">Abril</option>
                                    <option value="05">Mayo</option>
                                    <option value="06">Junio</option>
                                    <option value="07">Julio</option>
                                    <option value="08">Agosto</option>
                                    <option value="09">Septiembre</option>
                                    <option value="10">Octubre</option>
                                    <option value="11">Noviembre</option>
                                    <option value="12">Diciembre</option>
                                </select>
                            </div>
                            <div class="col-md-3 mb-3">
                                <label class="form-label">
                                    <i class="fas fa-exchange-alt me-1"></i>Tipo
                                </label>
                                <select class="form-select" id="filterTipo" onchange="applyFilters()">
                                    <option value="">Todos</option>
                                    <option value="I">Ingresos</option>
                                    <option value="G">Gastos</option>
                                    <option value="V">Inversión</option>
                                    <option value="F">Flujo Neto</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Widget: Flujo de Efectivo -->
        <div class="row mb-4" id="widgetGastosReales">
            <div class="col-12">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <i class="fas fa-chart-line me-2"></i>Reporte: Flujo de Efectivo / Cashflow
                        </h5>
                        <div>
                            <button class="btn btn-sm btn-outline-primary me-2" onclick="refreshGastosReales()">
                                <i class="fas fa-sync-alt me-1"></i>Actualizar
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <!-- Indicadores Clave (Cards) -->
                        <div class="row mb-4">
                            <div class="col-md-3 mb-3">
                                <div class="card bg-gradient-success" style="background: rgba(25, 135, 84, 0.1); border: 1px solid rgba(25, 135, 84, 0.3);">
                                    <div class="card-body text-center">
                                        <i class="fas fa-arrow-up fa-2x text-success mb-2"></i>
                                        <h6 class="text-muted">Total Entradas</h6>
                                        <h3 class="text-success mb-0" id="totalEntradas">$0.00</h3>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3 mb-3">
                                <div class="card bg-gradient-danger" style="background: rgba(220, 53, 69, 0.1); border: 1px solid rgba(220, 53, 69, 0.3);">
                                    <div class="card-body text-center">
                                        <i class="fas fa-arrow-down fa-2x text-danger mb-2"></i>
                                        <h6 class="text-muted">Total Salidas</h6>
                                        <h3 class="text-danger mb-0" id="totalSalidas">$0.00</h3>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3 mb-3">
                                <div class="card" style="background: rgba(139, 92, 246, 0.1); border: 1px solid rgba(139, 92, 246, 0.3);">
                                    <div class="card-body text-center">
                                        <i class="fas fa-hand-holding-usd fa-2x mb-2" style="color: #8b5cf6;"></i>
                                        <h6 class="text-muted">Inversión Socios</h6>
                                        <h3 class="mb-0" id="totalInversion" style="color: #8b5cf6;">$0.00</h3>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3 mb-3">
                                <div class="card bg-gradient-info" style="background: rgba(13, 202, 240, 0.1); border: 1px solid rgba(13, 202, 240, 0.3);">
                                    <div class="card-body text-center">
                                        <i class="fas fa-balance-scale fa-2x text-info mb-2"></i>
                                        <h6 class="text-muted">Flujo Neto</h6>
                                        <h3 class="text-info mb-0" id="flujoNeto">$0.00</h3>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Gráfico de Líneas -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <div class="card" style="background: rgba(0, 0, 0, 0.2);">
                                    <div class="card-body">
                                        <h6 class="text-white mb-3">
                                            <i class="fas fa-chart-line me-2"></i>Evolución Mensual
                                        </h6>
                                        <canvas id="chartGastosReales" height="80"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Tabla Resumen -->
                        <div class="row">
                            <div class="col-12">
                                <div class="table-responsive">
                                    <table class="table table-dark table-hover">
                                        <thead>
                                            <tr>
                                                <th><i class="fas fa-calendar me-1"></i>Mes</th>
                                                <th class="text-end"><i class="fas fa-arrow-up me-1 text-success"></i>Entradas</th>
                                                <th class="text-end"><i class="fas fa-arrow-down me-1 text-danger"></i>Salidas</th>
                                                <th class="text-end"><i class="fas fa-hand-holding-usd me-1" style="color: #8b5cf6;"></i>Inversión</th>
                                                <th class="text-end"><i class="fas fa-balance-scale me-1 text-info"></i>Flujo</th>
                                            </tr>
                                        </thead>
                                        <tbody id="tablaGastosReales">
                                            <tr>
                                                <td colspan="5" class="text-center">
                                                    <i class="fas fa-spinner fa-spin me-2"></i>Cargando datos...
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Widget: Balance General -->
        <div class="row mb-4" id="widgetBalanceGeneral">
            <div class="col-12">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <i class="fas fa-balance-scale me-2"></i>Reporte: Balance General
                        </h5>
                        <div>
                            <button class="btn btn-sm btn-outline-primary me-2" onclick="refreshBalanceGeneral()">
                                <i class="fas fa-sync-alt me-1"></i>Actualizar
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        
                        <!-- Resumen Principal -->
                        <div class="row mb-4">
                            <div class="col-md-6 mb-3">
                                <div class="card" style="background: rgba(13, 202, 240, 0.1); border: 1px solid rgba(13, 202, 240, 0.3);">
                                    <div class="card-body text-center">
                                        <i class="fas fa-wallet fa-3x text-info mb-3"></i>
                                        <h6 class="text-muted mb-2">Inversión Total</h6>
                                        <h2 class="text-info mb-0" id="inversionTotal">$0.00</h2>
                                        <small class="text-muted" id="totalSocios">0 socios</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="card" style="background: rgba(82, 196, 26, 0.1); border: 1px solid rgba(82, 196, 26, 0.3);">
                                    <div class="card-body text-center">
                                        <i class="fas fa-university fa-3x text-success mb-3"></i>
                                        <h6 class="text-muted mb-2">Saldo Total en Cuentas</h6>
                                        <h2 class="text-success mb-0" id="saldoTotalCuentas">$0.00</h2>
                                        <small class="text-muted" id="numeroCuentas">0 cuentas</small>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Tabs de Balance -->
                        <ul class="nav nav-tabs mb-4" id="balanceGeneralTabs" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="socios-tab" data-bs-toggle="tab" data-bs-target="#socios" type="button" role="tab">
                                    <i class="fas fa-users me-1"></i>Inversión por Socio
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="cuentas-tab" data-bs-toggle="tab" data-bs-target="#cuentas" type="button" role="tab">
                                    <i class="fas fa-money-check-alt me-1"></i>Estado de Cuenta
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="participacion-tab" data-bs-toggle="tab" data-bs-target="#participacion" type="button" role="tab">
                                    <i class="fas fa-chart-pie me-1"></i>Participación Sociedad
                                </button>
                            </li>
                        </ul>

                        <!-- Tab Content -->
                        <div class="tab-content" id="balanceGeneralTabContent">
                            
                            <!-- Tab 1: Inversión por Socio -->
                            <div class="tab-pane fade show active" id="socios" role="tabpanel">
                                <div class="table-responsive">
                                    <table class="table table-dark table-hover">
                                        <thead>
                                            <tr>
                                                <th><i class="fas fa-user me-1"></i>Socio</th>
                                                <th class="text-end"><i class="fas fa-dollar-sign me-1"></i>Inversión</th>
                                                <th class="text-end"><i class="fas fa-percentage me-1"></i>% del Total</th>
                                                <th class="text-end"><i class="fas fa-calendar me-1"></i>Última Actualización</th>
                                            </tr>
                                        </thead>
                                        <tbody id="tablaSocios">
                                            <tr>
                                                <td colspan="4" class="text-center">
                                                    <i class="fas fa-spinner fa-spin me-2"></i>Cargando datos...
                                                </td>
                                            </tr>
                                        </tbody>
                                        <tfoot>
                                            <tr class="table-active">
                                                <th>TOTAL INVERSIÓN SOCIOS</th>
                                                <th class="text-end" id="totalInversionSocios">$0.00</th>
                                                <th class="text-end">100%</th>
                                                <th></th>
                                            </tr>
                                        </tfoot>
                                    </table>
                                </div>

                            </div>

                            <!-- Tab 2: Estado de Cuenta -->
                            <div class="tab-pane fade" id="cuentas" role="tabpanel">
                                <div class="row" id="cuentasBancarias">
                                    <div class="col-12 text-center">
                                        <i class="fas fa-spinner fa-spin me-2"></i>Cargando cuentas...
                                    </div>
                                </div>
                            </div>

                            <!-- Tab 3: Participación Sociedad -->
                            <div class="tab-pane fade" id="participacion" role="tabpanel">
                                <div class="row align-items-center">
                                    <div class="col-md-5">
                                        <div class="card" style="background: rgba(0, 0, 0, 0.2);">
                                            <div class="card-body">
                                                <h6 class="text-white mb-3">
                                                    <i class="fas fa-chart-pie me-2"></i>Distribución de Participación
                                                </h6>
                                                <div style="position: relative; height: 250px; width: 100%;">
                                                    <canvas id="chartParticipacion"></canvas>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="table-responsive">
                                            <table class="table table-dark table-hover">
                                                <thead>
                                                    <tr>
                                                        <th>Socio</th>
                                                        <th class="text-end">Participación</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="tablaParticipacion">
                                                    <tr>
                                                        <td colspan="2" class="text-center">
                                                            <i class="fas fa-spinner fa-spin me-2"></i>Cargando...
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Widget: Altas y Bajas de Alumnos (solo visible con Rockstar Skull) -->
        <div class="row mb-4" id="widgetAltasBajas" style="display: none;">
            <div class="col-12">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <i class="fas fa-user-graduate me-2"></i>Reporte: Altas y Bajas de Alumnos
                        </h5>
                        <div>
                            <button class="btn btn-sm btn-outline-primary me-2" onclick="refreshAltasBajas()">
                                <i class="fas fa-sync-alt me-1"></i>Actualizar
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <!-- Indicadores -->
                        <div class="row mb-4">
                            <div class="col-md-3 mb-3">
                                <div class="card" style="background: rgba(25, 135, 84, 0.1); border: 1px solid rgba(25, 135, 84, 0.3);">
                                    <div class="card-body text-center">
                                        <i class="fas fa-user-plus fa-2x text-success mb-2"></i>
                                        <h6 class="text-muted">Total Altas</h6>
                                        <h3 class="text-success mb-0" id="totalAltas">0</h3>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3 mb-3">
                                <div class="card" style="background: rgba(220, 53, 69, 0.1); border: 1px solid rgba(220, 53, 69, 0.3);">
                                    <div class="card-body text-center">
                                        <i class="fas fa-user-minus fa-2x text-danger mb-2"></i>
                                        <h6 class="text-muted">Total Bajas</h6>
                                        <h3 class="text-danger mb-0" id="totalBajas">0</h3>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3 mb-3">
                                <div class="card" style="background: rgba(13, 202, 240, 0.1); border: 1px solid rgba(13, 202, 240, 0.3);">
                                    <div class="card-body text-center">
                                        <i class="fas fa-chart-line fa-2x text-info mb-2"></i>
                                        <h6 class="text-muted">Neto</h6>
                                        <h3 class="text-info mb-0" id="netoAltasBajas">0</h3>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3 mb-3">
                                <div class="card" style="background: rgba(255, 165, 0, 0.1); border: 1px solid rgba(255, 165, 0, 0.3);">
                                    <div class="card-body text-center">
                                        <i class="fas fa-users fa-2x text-orange mb-2"></i>
                                        <h6 class="text-muted">Total Inscritos</h6>
                                        <h3 class="text-orange mb-0" id="totalAlumnosRegistrados">0</h3>
                                        <small class="text-muted">(Grupal + Individual)</small>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Gráfico de Barras -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <div class="card" style="background: rgba(0, 0, 0, 0.2);">
                                    <div class="card-body">
                                        <h6 class="text-white mb-3">
                                            <i class="fas fa-chart-bar me-2"></i>Altas y Bajas Mensuales
                                        </h6>
                                        <canvas id="chartAltasBajas" height="80"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Tabla Resumen -->
                        <div class="row">
                            <div class="col-12">
                                <div class="table-responsive">
                                    <table class="table table-dark table-hover">
                                        <thead>
                                            <tr>
                                                <th><i class="fas fa-calendar me-1"></i>Mes</th>
                                                <th class="text-end"><i class="fas fa-user-plus me-1 text-success"></i>Altas</th>
                                                <th class="text-end"><i class="fas fa-user-minus me-1 text-danger"></i>Bajas</th>
                                                <th class="text-end"><i class="fas fa-chart-line me-1 text-info"></i>Neto</th>
                                                <th class="text-end"><i class="fas fa-users me-1 text-warning"></i>Activos</th>
                                            </tr>
                                        </thead>
                                        <tbody id="tablaAltasBajas">
                                            <tr>
                                                <td colspan="5" class="text-center text-muted">
                                                    <i class="fas fa-info-circle me-2"></i>
                                                    Selecciona la empresa Rockstar Skull para ver este reporte
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

   <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- SheetJS para exportación a Excel -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

    <!-- Theme Toggle - Cargar temprano para evitar flash -->
    <script src="js/theme-toggle.js?v=1.0.0"></script>

    <!-- Page Loader Module (reutilizable en todas las páginas) -->
    <script src="js/page-loader.js?v=1.0.0"></script>

    <!-- API Client v3.1.4 - Universal API Handler -->
    <script src="assets/js/api-client.js?v=3.1.4"></script>

    <!-- JAVASCRIPT MODULAR - ORDEN DE CARGA CRÍTICO -->
    <script src="js/dashboard-core.js?v=3.4.0"></script>
    <script src="js/dashboard-auth.js?v=3.1.3"></script>
    <script src="js/dashboard-api.js?v=3.1.3"></script>
    <script src="js/reportes-widgets.js?v=3.6.0"></script>   <!-- v3.6.0: Fix filtro Flujo Neto no enviar tipo=F al API + UTC desfase -->
    <script src="js/user-permissions.js?v=1.2.0"></script>   <!-- v1.1.0: Permisos por página y navegación -->
    <script>if (typeof window.checkPageAccess === 'function') window.checkPageAccess();</script>
    <script>
        // Mostrar loader al inicio
        if (typeof showPageLoader === 'function') {
            showPageLoader('Cargando módulo de Reportes...');
        }
    </script>
    <script src="js/reportes-init.js?v=3.4.0"></script>      <!-- v3.4.0: Fix UTC desfase periodo + scroll preserve -->
    <script>
        // Observer para re-renderizar gráficas al cambiar el tema
        new MutationObserver(() => {
            if (typeof refreshAllChartsForTheme === 'function') refreshAllChartsForTheme();
        }).observe(document.documentElement, { attributes: true, attributeFilter: ['data-theme'] });
    </script>

</body>
</html>