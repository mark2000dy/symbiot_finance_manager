<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Dashboard - Sistema Integral de Gestion</title>
    
    <!-- PWA Configuration -->
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="assets/images/Symbiot_logo_dark_horizon.png">
    <meta name="theme-color" content="#191C24">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" rel="stylesheet">
    
    <!-- CSS MODULAR EXTRA√çDO -->
    <link rel="stylesheet" href="css/dashboard-main.css?v=3.2.1">
    <link rel="stylesheet" href="css/dashboard-widgets.css?v=3.2.1">
    <link rel="stylesheet" href="css/dashboard-responsive.css?v=3.2.1">
    <link rel="stylesheet" href="css/theme-toggle.css?v=1.0.2">
    <!-- Anti-FOUC: aplicar tema antes del primer render -->
    <script>(function(){var t=localStorage.getItem('symbiot-theme');if(t==='light')document.documentElement.setAttribute('data-theme','light');}());</script>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="dashboard.html"><img class="logo-dark" src="assets/images/Symbiot_logo_dark_horizon.png" alt="SYMBIOT Logo"><img class="logo-light" src="assets/images/Symbiot_logo_clear_horizon.png" alt="SYMBIOT Logo"></a>
            
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Abrir navegaci√≥n">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item" id="navLinkDashboard">
                        <a class="nav-link active" href="dashboard.html">
                            <i class="fas fa-tachometer-alt me-1"></i>Dashboard
                        </a>
                    </li>
                    <li class="nav-item" id="navLinkGastos">
                        <a class="nav-link" href="gastos.html">
                            <i class="fas fa-money-bill-wave me-1"></i>Gastos
                        </a>
                    </li>
                    <li class="nav-item" id="navLinkIngresos">
                        <a class="nav-link" href="ingresos.html">
                            <i class="fas fa-coins me-1"></i>Ingresos
                        </a>
                    </li>
                    <li class="nav-item" id="navLinkReportes">
                        <a class="nav-link" href="reportes.html">
                            <i class="fas fa-chart-bar me-1"></i>Reportes
                        </a>
                    </li>
                    <li class="nav-item" id="navLinkMaestros" style="display:none;">
                        <a class="nav-link" href="maestros.html">
                            <i class="fas fa-chalkboard-teacher me-1"></i>Maestros
                        </a>
                    </li>
                    <li class="nav-item" id="navLinkPagos" style="display:none;">
                        <a class="nav-link" href="pagos.html">
                            <i class="fas fa-hand-holding-usd me-1"></i>Pagos
                        </a>
                    </li>
                </ul>
                
                <ul class="navbar-nav">
                    <!-- Theme Toggle Button -->
                    <li class="nav-item d-flex align-items-center">
                        <button type="button" id="themeToggleBtn" class="theme-toggle-btn" title="Cambiar tema" aria-label="Cambiar tema">
                            <i class="fas fa-sun"></i>
                        </button>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown">
                            <i class="fas fa-user-circle me-1"></i>
                            <span id="userName">Usuario</span>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li><a class="dropdown-item" href="#" onclick="showUserProfile()">
                                <i class="fas fa-user me-2"></i>Mi Perfil
                            </a></li>
                            <li><a class="dropdown-item" href="configuracion.html">
                                <i class="fas fa-cog me-2"></i>Configuraci√≥n
                            </a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="#" onclick="logout()">
                                <i class="fas fa-sign-out-alt me-2"></i>Cerrar Sesi√≥n
                            </a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container-fluid">
        <div class="main-content">
            <!-- Welcome Banner -->
            <div class="welcome-banner d-flex align-items-center justify-content-center" id="welcomeBanner">
                <div class="text-center">
                    <h4 class="mb-1"><i class="fas fa-chart-pie me-2"></i>Dashboard Financiero</h4>
                    <p class="mb-0">¬°Bienvenido, <span id="userNameDisplay">Usuario</span>! ‚Ä¢
                        <i class="fas fa-building me-1"></i>
                        <span id="userCompany">Cargando...</span> ‚Ä¢
                        <span id="currentDate"></span>
                    </p>
                </div>
            </div>

            <!-- Statistics Cards -->
            <div class="row mb-4" id="statisticsCardsRow">
                <!-- Balance General -->
                <div class="col-sm-6 col-xl mb-3">
                    <div class="card stat-card h-100">
                        <div class="card-body d-flex align-items-center">
                            <i class="fas fa-balance-scale stat-icon text-info me-3"></i>
                            <div>
                                <h6 class="card-title">Balance General</h6>
                                <h4 class="text-info mb-0" id="balanceTotal">
                                    <div class="loading-spinner">
                                        <i class="fas fa-spinner fa-spin"></i>
                                    </div>
                                </h4>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Inversi√≥n Socios -->
                <div class="col-sm-6 col-xl mb-3">
                    <div class="card stat-card h-100">
                        <div class="card-body d-flex align-items-center">
                            <i class="fas fa-hand-holding-usd stat-icon text-purple me-3" style="color: #8b5cf6;"></i>
                            <div>
                                <h6 class="card-title">Inversi√≥n Socios</h6>
                                <h4 class="mb-0" id="inversionSocios" style="color: #8b5cf6;">
                                    <div class="loading-spinner">
                                        <i class="fas fa-spinner fa-spin"></i>
                                    </div>
                                </h4>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Total Ingresos -->
                <div class="col-sm-6 col-xl mb-3">
                    <div class="card stat-card h-100">
                        <div class="card-body d-flex align-items-center">
                            <i class="fas fa-arrow-up stat-icon text-success me-3"></i>
                            <div>
                                <h6 class="card-title">Total Ingresos</h6>
                                <h4 class="text-success mb-0" id="totalIngresos">
                                    <div class="loading-spinner">
                                        <i class="fas fa-spinner fa-spin"></i>
                                    </div>
                                </h4>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Total Gastos -->
                <div class="col-sm-6 col-xl mb-3">
                    <div class="card stat-card h-100">
                        <div class="card-body d-flex align-items-center">
                            <i class="fas fa-arrow-down stat-icon text-danger me-3"></i>
                            <div>
                                <h6 class="card-title">Total Gastos</h6>
                                <h4 class="text-danger mb-0" id="totalGastos">
                                    <div class="loading-spinner">
                                        <i class="fas fa-spinner fa-spin"></i>
                                    </div>
                                </h4>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Este Mes -->
                <div class="col-sm-6 col-xl mb-3">
                    <div class="card stat-card h-100">
                        <div class="card-body d-flex align-items-center">
                            <i class="fas fa-calendar stat-icon text-warning me-3"></i>
                            <div>
                                <h6 class="card-title">Balance Este Mes</h6>
                                <h4 class="text-warning mb-0" id="esteMes">
                                    <div class="loading-spinner">
                                        <i class="fas fa-spinner fa-spin"></i>
                                    </div>
                                </h4>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Company Selector Widget -->
            <div class="row mb-4" id="companySelectorWidget">
                <div class="col-12">
                    <div class="card company-selector-widget">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h6 class="text-white mb-0">
                                <i class="fas fa-building me-2"></i>Selector de Empresa
                            </h6>
                            <small class="text-muted">Filtrar datos por empresa</small>
                        </div>
                        <div class="card-body">
                            <div class="row align-items-center">
                                <div class="col-md-3">
                                    <label for="companyFilter" class="form-label">
                                        <i class="fas fa-filter me-1"></i>Empresa
                                    </label>
                                    <select class="form-select" id="companyFilter" onchange="handleCompanyChange()">
                                        <option value="">üè¢ Todas las Empresas</option>
                                        <option value="1">üé∏ Rockstar Skull</option>
                                        <option value="2">üöÄ Symbiot Technologies</option>
                                    </select>
                                </div>
                                <div class="col-md-3">
                                    <div class="text-center">
                                        <div class="stat-number text-success" id="companyBalance">$0.00</div>
                                        <div class="stat-label">Balance Empresa</div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="text-center">
                                        <div class="stat-number text-warning" id="companyTransactions">0</div>
                                        <div class="stat-label">Transacciones</div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="text-center">
                                        <div class="stat-number text-info" id="companyStudents">0</div>
                                        <div class="stat-label">Alumnos Activos</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- RockstarSkull Specific Indicators (Hidden by default) -->
                            <div id="rockstarSpecificIndicators" style="display: none;">
                                <hr class="my-3">
                                <div class="row text-center">
                                    <div class="col-md-2">
                                        <div class="metric-item">
                                            <div class="stat-number text-info" id="groupClasses">0</div>
                                            <div class="stat-label">Clases Grupales</div>
                                        </div>
                                    </div>
                                    <div class="col-md-2">
                                        <div class="metric-item">
                                            <div class="stat-number text-info" id="individualClasses">0</div>
                                            <div class="stat-label">Clases Individuales</div>
                                        </div>
                                    </div>
                                    <div class="col-md-2">
                                        <div class="metric-item">
                                            <div class="stat-number text-success" id="currentStudents">0</div>
                                            <div class="stat-label">Al Corriente</div>
                                        </div>
                                    </div>
                                    <div class="col-md-2">
                                        <div class="metric-item">
                                            <div class="stat-number text-danger" id="pendingStudents">0</div>
                                            <div class="stat-label">Pendientes</div>
                                        </div>
                                    </div>
                                    <div class="col-md-2">
                                        <div class="metric-item">
                                            <div class="stat-number text-warning" id="inversionMKT">$0</div>
                                            <div class="stat-label">Inversi√≥n MKT</div>
                                        </div>
                                    </div>
                                    <div class="col-md-2">
                                        <div class="metric-item">
                                            <div class="stat-number text-success" id="nuevosAlumnosMes">0</div>
                                            <div class="stat-label">Nuevos Alumnos Este Mes</div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Symbiot Technologies Specific Indicators (Hidden by default) -->
                            <div id="symbiotSpecificIndicators" style="display: none;">
                                <hr class="my-3">
                                <div class="row text-center">
                                    <div class="col-md-2">
                                        <div class="metric-item">
                                            <div class="stat-number text-success" id="symSensoresActivos">0</div>
                                            <div class="stat-label">Sensores Activos</div>
                                        </div>
                                    </div>
                                    <div class="col-md-2">
                                        <div class="metric-item">
                                            <div class="stat-number text-info" id="symPaisMX">0</div>
                                            <div class="stat-label">Activos MX</div>
                                        </div>
                                    </div>
                                    <div class="col-md-2">
                                        <div class="metric-item">
                                            <div class="stat-number text-info" id="symPaisCL">0</div>
                                            <div class="stat-label">Activos CL</div>
                                        </div>
                                    </div>
                                    <div class="col-md-2">
                                        <div class="metric-item">
                                            <div class="stat-number text-success" id="symEncendidos">0</div>
                                            <div class="stat-label">Encendidos / Mes</div>
                                        </div>
                                    </div>
                                    <div class="col-md-2">
                                        <div class="metric-item">
                                            <div class="stat-number text-danger" id="symFueraLinea">0</div>
                                            <div class="stat-label">Fuera de L√≠nea</div>
                                        </div>
                                    </div>
                                    <div class="col-md-2">
                                        <div class="metric-item">
                                            <div class="stat-number text-warning" id="symFabricacion">0</div>
                                            <div class="stat-label">En Fabricaci√≥n</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- RockstarSkull Specific Widgets (Hidden by default) -->
            <div id="rockstarSkullWidgets" style="display: none;">
                <!-- Students Overview Widget -->
                <div class="row mb-4">
                    <div class="col-xl-6 mb-3">
                        <div class="card h-100">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h6 class="text-white mb-0">
                                    <i class="fas fa-users me-2"></i>Alumnos Inscritos
                                </h6>
                                <span class="badge bg-primary" id="totalStudents" style="cursor: pointer; font-size: 1.1rem; padding: 0.5rem 0.75rem;" onclick="filterStudentsByStatus('all')">0</span>
                            </div>
                            <div class="card-body">
                                <div class="row text-center">
                                    <div class="col-6">
                                        <div class="student-stat" style="cursor: pointer;" onclick="filterStudentsByStatus('active')">
                                            <h2 class="text-success mb-2 fw-bold" id="activeStudents" style="font-size: 2.5rem;">0</h2>
                                            <small style="color: #4ac711 !important; font-weight: 700; font-size: 0.95rem;">Activos</small>
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="student-stat" style="cursor: pointer;" onclick="filterStudentsByStatus('inactive')">
                                            <h2 class="text-danger mb-2 fw-bold" id="inactiveStudents" style="font-size: 2.5rem;">0</h2>
                                            <small style="color: #dc1313 !important; font-weight: 700; font-size: 0.95rem;">Bajas</small>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Classes Distribution -->
                                <div class="mt-3">
                                    <small style="color: var(--text-secondary); font-weight: 600;">Distribuci√≥n por Clase:</small>
                                    <div id="classDistribution" class="mt-2">
                                        <!-- Se llena din√°micamente -->
                                    </div>
                                </div>
                                
                                <!-- Iconos de instrumentos -->
                                <div class="mt-3 d-flex justify-content-around" style="font-size: 1.5rem; opacity: 0.6;">
                                    <i class="fas fa-guitar text-primary" title="Guitarra"></i>
                                    <i class="fas fa-drum text-danger" title="Bater√≠a"></i>
                                    <i class="fas fa-music text-warning" title="Piano"></i>
                                    <i class="fas fa-microphone text-info" title="Canto"></i>
                                </div>

                                <!-- Altas y Bajas del Mes en Curso -->
                                <div class="mt-3 pt-3" style="border-top: 1px solid rgba(255,255,255,0.1);">
                                    <small style="color: var(--text-secondary); font-weight: 600;">
                                        <i class="fas fa-exchange-alt me-1"></i>Movimientos del Mes:
                                    </small>
                                    <div id="altasBajasCurrentMonth" class="row text-center mt-2">
                                        <div class="col-6">
                                            <div style="background: rgba(40,167,69,0.15); border-radius: 8px; padding: 8px;">
                                                <i class="fas fa-user-plus text-success"></i>
                                                <div class="fw-bold text-success" id="altasMesActual" style="font-size: 1.3rem;">-</div>
                                                <small style="color: #adb5bd; font-size: 0.75rem;">Altas</small>
                                            </div>
                                        </div>
                                        <div class="col-6">
                                            <div style="background: rgba(220,53,69,0.15); border-radius: 8px; padding: 8px;">
                                                <i class="fas fa-user-minus text-danger"></i>
                                                <div class="fw-bold text-danger" id="bajasMesActual" style="font-size: 1.3rem;">-</div>
                                                <small style="color: #adb5bd; font-size: 0.75rem;">Bajas</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Teachers Overview Widget -->
                    <div class="col-xl-6 mb-3" id="maestrosWidget">
                        <div class="card h-100">
                            <div class="card-header">
                                <h6 class="text-white mb-0">
                                    <i class="fas fa-chalkboard-teacher me-2"></i>Maestros RockstarSkull
                                </h6>
                            </div>
                            <div class="card-body">
                                <div id="teachersOverview">
                                    <!-- Se llena din√°micamente -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Payment Alerts Widget -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="card payment-alert-card">
                            <div class="card-header payment-alert-header d-flex justify-content-between align-items-center">
                                <h6 class="text-white mb-0">
                                    <i class="fas fa-bell me-2"></i>Alertas de Pagos
                                </h6>
                                <button class="btn btn-sm btn-outline-primary" onclick="refreshPaymentAlerts()">
                                    <i class="fas fa-sync-alt me-1"></i>Actualizar
                                </button>
                            </div>
                            <div class="card-body" id="paymentAlertsContainer">
                                <div class="text-center text-muted">
                                    <i class="fas fa-spinner fa-spin"></i>
                                    <p class="mt-2 mb-0">Cargando alertas de pagos...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Students Management System -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h6 class="text-white mb-0">
                                    <i class="fas fa-graduation-cap me-2"></i>Gesti√≥n de Alumnos - RockstarSkull
                                </h6>
                                <div class="d-flex flex-wrap gap-1 justify-content-end">
                                    <button class="btn btn-sm btn-outline-info" onclick="exportStudentsList()" title="Exportar lista">
                                        <i class="fas fa-download"></i><span class="d-none d-sm-inline ms-1">Exportar</span>
                                    </button>
                                    <button class="btn btn-sm btn-outline-primary" onclick="refreshStudentsList()" title="Actualizar">
                                        <i class="fas fa-sync-alt"></i><span class="d-none d-sm-inline ms-1">Actualizar</span>
                                    </button>
                                    <button id="syncAllCalendarBtn" class="btn btn-sm btn-outline-warning" onclick="syncAllStudentsCalendar()" title="Sincronizar Google Calendar">
                                        <i class="fab fa-google"></i><span class="d-none d-md-inline ms-1">Sincronizar</span>
                                    </button>
                                    <button class="btn btn-sm btn-success" onclick="showAddStudentModal()" title="Nuevo Alumno">
                                        <i class="fas fa-plus"></i><span class="d-none d-sm-inline ms-1">Nuevo Alumno</span>
                                    </button>
                                </div>
                            </div>
                            <div class="card-body p-0">

                                <!-- Pesta√±as del Gestor de Alumnos -->
                                <ul class="nav nav-tabs px-3 pt-2" id="gestorAlumnosTabs" role="tablist">
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link active" id="tab-lista-btn"
                                                data-bs-toggle="tab" data-bs-target="#tab-lista"
                                                type="button" role="tab" aria-selected="true">
                                            <i class="fas fa-list me-1"></i>Lista de Alumnos
                                        </button>
                                    </li>
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link" id="tab-horarios-btn"
                                                data-bs-toggle="tab" data-bs-target="#tab-horarios"
                                                type="button" role="tab" aria-selected="false">
                                            <i class="fas fa-calendar-week me-1"></i>Horarios Disponibles
                                        </button>
                                    </li>
                                </ul>

                                <div class="tab-content">

                                    <!-- Tab 1: Lista de Alumnos (contenido existente) -->
                                    <div class="tab-pane fade show active p-3" id="tab-lista" role="tabpanel" aria-labelledby="tab-lista-btn">

                                        <!-- Student Filters -->
                                        <div class="students-filters">
                                            <div class="row">
                                                <div class="col-md-3 col-lg mb-2">
                                                    <label class="form-label">
                                                        <i class="fas fa-filter me-1"></i>Maestro
                                                    </label>
                                                    <select class="form-select form-select-sm" id="teacherFilter" onchange="filterStudents()">
                                                        <option value="">üë®‚Äçüè´ Todos los Maestros</option>
                                                    </select>
                                                </div>
                                                <div class="col-md-3 col-lg mb-2">
                                                    <label class="form-label">
                                                        <i class="fas fa-user-check me-1"></i>Estatus
                                                    </label>
                                                    <select class="form-select form-select-sm" id="statusFilter" onchange="filterStudents()">
                                                        <option value="">üìã Todos</option>
                                                        <option value="Activo">‚úÖ Activos</option>
                                                        <option value="Baja">‚ùå Bajas</option>
                                                    </select>
                                                </div>
                                                <div class="col-md-3 col-lg mb-2">
                                                    <label class="form-label">
                                                        <i class="fas fa-music me-1"></i>Instrumento
                                                    </label>
                                                    <select class="form-select form-select-sm" id="instrumentFilter" onchange="filterStudents()">
                                                        <option value="">üéµ Todos</option>
                                                    </select>
                                                </div>
                                                <div class="col-md-3 col-lg mb-2">
                                                    <label class="form-label">
                                                        <i class="fas fa-chalkboard me-1"></i>Tipo de Clase
                                                    </label>
                                                    <select class="form-select form-select-sm" id="tipoClaseFilter" onchange="filterStudents()">
                                                        <option value="">üìö Todos</option>
                                                        <option value="Individual">üë§ Individual</option>
                                                        <option value="Grupal">üë• Grupal</option>
                                                    </select>
                                                </div>
                                                <div class="col-md-3 col-lg mb-2">
                                                    <label class="form-label">
                                                        <i class="fas fa-money-bill me-1"></i>Pagos
                                                    </label>
                                                    <select class="form-select form-select-sm" id="paymentFilter" onchange="filterStudents()">
                                                        <option value="">üí∞ Todos</option>
                                                        <option value="current">‚úÖ Al corriente</option>
                                                        <option value="upcoming">‚è∞ Pr√≥ximos a vencer</option>
                                                        <option value="overdue">‚ùå Vencidos</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Students Table Container -->
                                        <div class="students-table-container">
                                            <!-- Loading State -->
                                            <div class="loading-state" id="studentsLoadingState">
                                                <i class="fas fa-spinner fa-spin fa-2x text-primary"></i>
                                                <p class="mt-2">Cargando lista de alumnos...</p>
                                            </div>

                                            <!-- Empty State -->
                                            <div class="empty-state" id="studentsEmptyState" style="display: none;">
                                                <i class="fas fa-user-graduate fa-3x mb-3" style="opacity: 0.3;"></i>
                                                <p>No se encontraron alumnos</p>
                                            </div>

                                            <!-- Students Table -->
                                            <div class="table-responsive" id="studentsTableContainer" style="display: none;">
                                                <table class="table table-sm table-dark table-hover">
                                                    <thead>
                                                        <tr>
                                                            <th><i class="fas fa-user me-1"></i>Alumno</th>
                                                            <th><i class="fas fa-music me-1"></i>Instrumento</th>
                                                            <th><i class="fas fa-user-tie me-1"></i>Maestro</th>
                                                            <th><i class="fas fa-user-check me-1"></i>Estatus</th>
                                                            <th><i class="fas fa-calendar me-1"></i>Pr√≥ximo Pago</th>
                                                            <th><i class="fas fa-money-bill me-1"></i>Estado Pago</th>
                                                            <th><i class="fas fa-cogs me-1"></i>Acciones</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="studentsTableBody">
                                                        <!-- Se llena din√°micamente -->
                                                    </tbody>
                                                </table>
                                            </div>

                                            <!-- Students Pagination -->
                                            <div class="pagination-container" id="studentsPaginationContainer" style="display: none;">
                                                <div class="pagination-info">
                                                    <small>
                                                        Mostrando <span id="studentsShowingFrom">1</span> - <span id="studentsShowingTo">10</span>
                                                        de <span id="studentsTotalRecords">0</span> alumnos
                                                    </small>
                                                </div>
                                                <nav>
                                                    <ul class="pagination pagination-sm mb-0" id="studentsPaginationList">
                                                        <!-- Se genera din√°micamente -->
                                                    </ul>
                                                </nav>
                                            </div>
                                        </div>

                                    </div><!-- /tab-lista -->

                                    <!-- Tab 2: Horarios Disponibles -->
                                    <div class="tab-pane fade p-3" id="tab-horarios" role="tabpanel" aria-labelledby="tab-horarios-btn">
                                        <div id="horariosLoading" class="text-center py-5">
                                            <i class="fas fa-spinner fa-spin fa-2x text-primary"></i>
                                            <p class="mt-2 text-muted">Cargando horarios...</p>
                                        </div>
                                        <div id="horariosContainer" style="display:none;"></div>
                                    </div><!-- /tab-horarios -->

                                </div><!-- /tab-content -->
                            </div><!-- /card-body -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- ===================================================== -->
            <!-- Symbiot Technologies Specific Widgets (Hidden by default) -->
            <!-- ===================================================== -->
            <div id="symbiotWidgets" style="display: none;">

                <!-- Widget 1: Sensores Instalados + Widget 2: Clientes -->
                <div class="row mb-4">

                    <!-- Sensores Instalados (homologado con Alumnos Inscritos) -->
                    <div class="col-xl-6 mb-3">
                        <div class="card h-100">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h6 class="text-white mb-0">
                                    <i class="fas fa-microchip me-2"></i>Sensores Instalados
                                </h6>
                                <span class="badge bg-primary" id="symTotalSensores" style="font-size: 1.1rem; padding: 0.5rem 0.75rem;">0</span>
                            </div>
                            <div class="card-body">
                                <!-- Stats principales: Activos / Fuera de l√≠nea -->
                                <div class="row text-center">
                                    <div class="col-6">
                                        <div class="student-stat">
                                            <h2 class="text-success mb-2 fw-bold" id="symActivosCard" style="font-size: 2.5rem;">0</h2>
                                            <small style="color: #4ac711 !important; font-weight: 700; font-size: 0.95rem;">Activos</small>
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="student-stat">
                                            <h2 class="text-danger mb-2 fw-bold" id="symInactivosCard" style="font-size: 2.5rem;">0</h2>
                                            <small style="color: #dc1313 !important; font-weight: 700; font-size: 0.95rem;">Fuera de l√≠nea</small>
                                        </div>
                                    </div>
                                </div>

                                <!-- Distribuci√≥n Geogr√°fica -->
                                <div class="mt-3">
                                    <small style="color: var(--text-secondary); font-weight: 600;">Distribuci√≥n Geogr√°fica:</small>
                                    <div id="symGeoDistribution" class="mt-2">
                                        <!-- Se llena din√°micamente -->
                                    </div>
                                </div>

                                <!-- Iconos decorativos -->
                                <div class="mt-3 d-flex justify-content-around" style="font-size: 1.5rem; opacity: 0.6;">
                                    <i class="fas fa-microchip text-primary" title="Sensores"></i>
                                    <i class="fas fa-wifi text-success" title="Conectados"></i>
                                    <i class="fas fa-plug text-danger" title="Desconectados"></i>
                                    <i class="fas fa-tools text-warning" title="En fabricaci√≥n"></i>
                                </div>

                                <!-- Modelos de Sensor -->
                                <div class="mt-3">
                                    <small style="color: var(--text-secondary); font-weight: 600;">
                                        <i class="fas fa-microchip me-1"></i>Modelos de Sensor:
                                    </small>
                                    <div id="symModelosSensor" class="mt-2">
                                        <!-- Se llena din√°micamente -->
                                    </div>
                                </div>

                                <!-- Movimientos del Mes -->
                                <div class="mt-3 pt-3" style="border-top: 1px solid rgba(255,255,255,0.1);">
                                    <small style="color: var(--text-secondary); font-weight: 600;">
                                        <i class="fas fa-exchange-alt me-1"></i>Movimientos del Mes:
                                    </small>
                                    <div class="row text-center mt-2">
                                        <div class="col-4">
                                            <div style="background: rgba(40,167,69,0.15); border-radius: 8px; padding: 8px;">
                                                <i class="fas fa-power-off text-success"></i>
                                                <div class="fw-bold text-success" id="symEncendidosMes" style="font-size: 1.3rem;">-</div>
                                                <small style="color: #adb5bd; font-size: 0.75rem;">Encendidos</small>
                                            </div>
                                        </div>
                                        <div class="col-4">
                                            <div style="background: rgba(220,53,69,0.15); border-radius: 8px; padding: 8px;">
                                                <i class="fas fa-unlink text-danger"></i>
                                                <div class="fw-bold text-danger" id="symDesconectadosMes" style="font-size: 1.3rem;">-</div>
                                                <small style="color: #adb5bd; font-size: 0.75rem;">Desconectados</small>
                                            </div>
                                        </div>
                                        <div class="col-4">
                                            <div style="background: rgba(255,193,7,0.15); border-radius: 8px; padding: 8px;">
                                                <i class="fas fa-tools text-warning"></i>
                                                <div class="fw-bold text-warning" id="symNuevosPedidosMes" style="font-size: 1.3rem;">-</div>
                                                <small style="color: #adb5bd; font-size: 0.75rem;">En fabricaci√≥n</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- ID oculto para mantener compat. con _updateSensoresCard -->
                                <span id="symFabricacionCard" style="display:none;">0</span>
                            </div>
                        </div>
                    </div>

                    <!-- Clientes Symbiot ‚Äî formato Maestros -->
                    <div class="col-xl-6 mb-3" id="symClientesWidget">
                        <div class="card h-100">
                            <div class="card-header">
                                <h6 class="text-white mb-0">
                                    <i class="fas fa-handshake me-2"></i>Clientes Symbiot
                                </h6>
                            </div>
                            <div class="card-body" style="overflow-y: auto; max-height: 520px;">
                                <!-- Cards de clientes (formato Maestros) -->
                                <div id="symClientesOverview">
                                    <div class="text-center py-4">
                                        <i class="fas fa-spinner fa-spin text-info fa-2x mb-2"></i>
                                        <p class="text-muted mb-0">Cargando clientes...</p>
                                    </div>
                                </div>

                                <!-- IDs ocultos para compat. con _updateMovimientosMes -->
                                <span id="symClientesActivos" style="display:none;">0</span>
                                <span id="symClientesTotal"   style="display:none;">0</span>
                            </div>
                        </div>
                    </div>

                </div>

                <!-- Widget 2: Alertas de Suscripci√≥n -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h6 class="text-white mb-0">
                                    <i class="fas fa-exclamation-triangle me-2"></i>Alertas de Suscripci√≥n
                                    <span class="badge bg-warning ms-2" id="symAlertasCount">0</span>
                                </h6>
                            </div>
                            <div class="card-body">
                                <div id="symAlertasEmpty" class="text-center py-3" style="display: none;">
                                    <i class="fas fa-check-circle fa-2x text-success mb-2"></i>
                                    <p class="text-muted mb-0">Todas las suscripciones est√°n al corriente</p>
                                </div>
                                <div class="table-responsive" id="symAlertasTable" style="display: none;">
                                    <table class="table table-dark table-hover mb-0">
                                        <thead>
                                            <tr>
                                                <th>Cliente</th>
                                                <th>Empresa</th>
                                                <th>Pa√≠s</th>
                                                <th>Suscripci√≥n</th>
                                                <th>Vence</th>
                                                <th class="text-center">D√≠as</th>
                                            </tr>
                                        </thead>
                                        <tbody id="symAlertasBody"></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Widget 3: Gesti√≥n de Sensores -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h6 class="text-white mb-0">
                                    <i class="fas fa-cogs me-2"></i>Gesti√≥n de Sensores y Clientes
                                </h6>
                                <div class="d-flex gap-2">
                                    <button type="button" class="btn btn-sm btn-outline-info" onclick="refreshSymbiotData()">
                                        <i class="fas fa-sync-alt me-1"></i>Actualizar
                                    </button>
                                </div>
                            </div>
                            <div class="card-body">
                                <!-- Tabs -->
                                <ul class="nav nav-tabs mb-3" id="symbiotTabs">
                                    <li class="nav-item">
                                        <a class="nav-link active" data-bs-toggle="tab" href="#symTabSensores">
                                            <i class="fas fa-microchip me-1"></i>Sensores
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" data-bs-toggle="tab" href="#symTabClientes">
                                            <i class="fas fa-handshake me-1"></i>Clientes
                                        </a>
                                    </li>
                                </ul>

                                <div class="tab-content">
                                    <!-- Tab: Lista de Sensores -->
                                    <div class="tab-pane fade show active" id="symTabSensores">
                                        <!-- Filtros -->
                                        <div class="row mb-3 g-2">
                                            <div class="col-md-3">
                                                <select class="form-select form-select-sm" id="symFilterEstado" onchange="loadSensoresList()">
                                                    <option value="">Todos los estados</option>
                                                    <option value="Activo">Activo</option>
                                                    <option value="Inactivo">Inactivo</option>
                                                    <option value="Fabricacion">En Fabricaci√≥n</option>
                                                </select>
                                            </div>
                                            <div class="col-md-3">
                                                <select class="form-select form-select-sm" id="symFilterPais" onchange="loadSensoresList()">
                                                    <option value="">Todos los pa√≠ses</option>
                                                    <option value="M√©xico">M√©xico</option>
                                                    <option value="Chile">Chile</option>
                                                </select>
                                            </div>
                                            <div class="col-md-3">
                                                <select class="form-select form-select-sm" id="symFilterCliente" onchange="loadSensoresList()">
                                                    <option value="">Todos los clientes</option>
                                                </select>
                                            </div>
                                            <div class="col-md-3 text-end">
                                                <button type="button" class="btn btn-sm btn-success" onclick="openSensorModal()">
                                                    <i class="fas fa-plus me-1"></i>Nuevo Sensor
                                                </button>
                                            </div>
                                        </div>
                                        <!-- Tabla -->
                                        <div class="table-responsive">
                                            <table class="table table-dark table-hover mb-0">
                                                <thead>
                                                    <tr>
                                                        <th>Nombre</th>
                                                        <th>Tipo</th>
                                                        <th>Pa√≠s / Ciudad</th>
                                                        <th>Cliente</th>
                                                        <th class="text-center">Estado</th>
                                                        <th>√öltimo contacto</th>
                                                        <th class="text-center">Acciones</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="symSensoresBody">
                                                    <tr><td colspan="7" class="text-center text-muted py-3">Cargando...</td></tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>

                                    <!-- Tab: Lista de Clientes -->
                                    <div class="tab-pane fade" id="symTabClientes">
                                        <div class="row mb-3 g-2">
                                            <div class="col-md-3">
                                                <select class="form-select form-select-sm" id="symFilterClienteEstatus" onchange="loadClientesList()">
                                                    <option value="">Todos</option>
                                                    <option value="Activo">Activos</option>
                                                    <option value="Baja">Bajas</option>
                                                </select>
                                            </div>
                                            <div class="col-md-6"></div>
                                            <div class="col-md-3 text-end">
                                                <button type="button" class="btn btn-sm btn-success" onclick="openClienteModal()">
                                                    <i class="fas fa-plus me-1"></i>Nuevo Cliente
                                                </button>
                                            </div>
                                        </div>
                                        <div class="table-responsive">
                                            <table class="table table-dark table-hover mb-0">
                                                <thead>
                                                    <tr>
                                                        <th>Nombre</th>
                                                        <th>Empresa</th>
                                                        <th>Pa√≠s</th>
                                                        <th class="text-center">Suscripci√≥n</th>
                                                        <th class="text-center">Precio</th>
                                                        <th>Vencimiento</th>
                                                        <th class="text-center">Estatus</th>
                                                        <th class="text-center">Acciones</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="symClientesBody">
                                                    <tr><td colspan="8" class="text-center text-muted py-3">Cargando...</td></tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div><!-- /symbiotWidgets -->

            <!-- Modal: Nuevo/Editar Sensor -->
            <div class="modal fade" id="sensorModal" tabindex="-1" aria-labelledby="sensorModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-xl">
                    <div class="modal-content bg-dark text-white">
                        <div class="modal-header">
                            <h5 class="modal-title" id="sensorModalLabel">Nuevo Sensor</h5>
                            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Cerrar" title="Cerrar"></button>
                        </div>
                        <div class="modal-body">
                            <input type="hidden" id="sensorId">

                            <!-- Secci√≥n 1: Informaci√≥n b√°sica -->
                            <h6 class="text-info mb-3"><i class="fas fa-microchip me-2"></i>Informaci√≥n B√°sica</h6>
                            <div class="row g-3 mb-3">
                                <div class="col-md-6">
                                    <label class="form-label">Nombre <span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" id="sensorNombre" placeholder="Sensor-MX-001">
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Tipo de Sensor</label>
                                    <select class="form-select" id="sensorTipo">
                                        <option value="">‚Äî Seleccionar tipo ‚Äî</option>
                                        <option value="Aceler√≥metro Inal√°mbrico">Aceler√≥metro Inal√°mbrico</option>
                                        <option value="Temperatura Digital ESP01">Temperatura Digital ESP01</option>
                                        <option value="Control IR Aire Acondicionado Trane">Control IR Aire Acondicionado Trane</option>
                                        <option value="Control IR HVAC">Control IR HVAC</option>
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label">Conexi√≥n</label>
                                    <select class="form-select" id="sensorConexion">
                                        <option value="WiFi">WiFi</option>
                                        <option value="Ethernet">Ethernet</option>
                                        <option value="4G">4G</option>
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label">Estado</label>
                                    <select class="form-select" id="sensorEstado">
                                        <option value="Fabricacion">En Fabricaci√≥n</option>
                                        <option value="Activo">Activo</option>
                                        <option value="Inactivo">Inactivo</option>
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label">Cliente</label>
                                    <select class="form-select" id="sensorClienteId">
                                        <option value="">‚Äî Sin cliente ‚Äî</option>
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label">Pa√≠s</label>
                                    <select class="form-select" id="sensorPais">
                                        <option value="">‚Äî Sin asignar ‚Äî</option>
                                        <option value="M√©xico">M√©xico</option>
                                        <option value="Chile">Chile</option>
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label">Ciudad</label>
                                    <input type="text" class="form-control" id="sensorCiudad" placeholder="CDMX">
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label">Fecha de Instalaci√≥n</label>
                                    <input type="date" class="form-control" id="sensorFechaInstalacion">
                                </div>
                            </div>

                            <hr class="border-secondary">

                            <!-- Secci√≥n 2: Identificaci√≥n del dispositivo -->
                            <h6 class="text-info mb-3"><i class="fas fa-id-card me-2"></i>Identificaci√≥n del Dispositivo</h6>
                            <div class="row g-3 mb-3">
                                <div class="col-md-6">
                                    <label class="form-label">ID del Dispositivo</label>
                                    <input type="text" class="form-control font-monospace" id="sensorDeviceId" placeholder="728a89ac-19f9-4aaf-b87f-ecdb533f9a13">
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label">C√≥digo</label>
                                    <input type="text" class="form-control font-monospace" id="sensorDeviceCode" placeholder="MXCDMX01.A">
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label">Modelo HW</label>
                                    <input type="text" class="form-control" id="sensorModelo" placeholder="SYM-TH-100">
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Token</label>
                                    <input type="text" class="form-control font-monospace" id="sensorToken" placeholder="ef1b8735-9ec5-44bb-99bb-54bd5bbb2827">
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">URL de API</label>
                                    <input type="url" class="form-control" id="sensorApiUrl" placeholder="https://huellafunc.azurewebsites.net/api/">
                                </div>
                            </div>

                            <hr class="border-secondary">

                            <!-- Secci√≥n 3: Configuraci√≥n del firmware -->
                            <h6 class="text-info mb-3"><i class="fas fa-cog me-2"></i>Configuraci√≥n del Firmware</h6>
                            <div class="row g-3 mb-3">
                                <div class="col-md-3">
                                    <label class="form-label">Versi√≥n</label>
                                    <input type="text" class="form-control" id="sensorVersion" placeholder="2.3.018">
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label">Licencia</label>
                                    <input type="number" class="form-control" id="sensorLicencia" placeholder="1" min="0">
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label">Modo de Operaci√≥n</label>
                                    <select class="form-select" id="sensorModoOperacion">
                                        <option value="">‚Äî Seleccionar ‚Äî</option>
                                        <option value="M1">M1</option>
                                        <option value="M2">M2</option>
                                        <option value="M3">M3</option>
                                        <option value="M4">M4</option>
                                    </select>
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label">Frecuencia (Hz)</label>
                                    <input type="number" class="form-control" id="sensorFrecuencia" placeholder="250">
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label">Intervalo (min)</label>
                                    <input type="number" class="form-control" id="sensorIntervalo" placeholder="1">
                                </div>
                                <div class="col-9">
                                    <label class="form-label">Notas</label>
                                    <textarea class="form-control" id="sensorNotas" rows="2"></textarea>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                            <button type="button" class="btn btn-primary" onclick="saveSensor()">Guardar</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Modal: Nuevo/Editar Cliente -->
            <div class="modal fade" id="clienteSymbiotModal" tabindex="-1" aria-labelledby="clienteSymbiotModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content bg-dark text-white">
                        <div class="modal-header">
                            <h5 class="modal-title" id="clienteSymbiotModalLabel">Nuevo Cliente</h5>
                            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Cerrar" title="Cerrar"></button>
                        </div>
                        <div class="modal-body">
                            <input type="hidden" id="clienteSymbiotId">
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label class="form-label">Nombre <span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" id="clienteNombre" placeholder="Carlos Mendoza">
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Empresa</label>
                                    <input type="text" class="form-control" id="clienteEmpresa" placeholder="Agro-MX S.A.">
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Pa√≠s</label>
                                    <select class="form-select" id="clientePais">
                                        <option value="">‚Äî Seleccionar ‚Äî</option>
                                        <option value="M√©xico">M√©xico</option>
                                        <option value="Chile">Chile</option>
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Email</label>
                                    <input type="email" class="form-control" id="clienteEmail">
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Tel√©fono</label>
                                    <input type="text" class="form-control" id="clienteTelefono">
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Tipo de Suscripci√≥n</label>
                                    <select class="form-select" id="clienteTipoSuscripcion">
                                        <option value="Mensual">Mensual</option>
                                        <option value="Anual">Anual</option>
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Precio Suscripci√≥n ($)</label>
                                    <input type="number" class="form-control" id="clientePrecio" step="0.01" placeholder="1200.00">
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Estatus</label>
                                    <select class="form-select" id="clienteEstatus">
                                        <option value="Activo">Activo</option>
                                        <option value="Baja">Baja</option>
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Fecha de Inicio</label>
                                    <input type="date" class="form-control" id="clienteFechaInicio">
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Fecha de Vencimiento</label>
                                    <input type="date" class="form-control" id="clienteFechaVencimiento">
                                </div>
                                <div class="col-12">
                                    <label class="form-label">Notas</label>
                                    <textarea class="form-control" id="clienteNotas" rows="2"></textarea>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                            <button type="button" class="btn btn-primary" onclick="saveClienteSymbiot()">Guardar</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Transactions Widget -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h6 class="text-white mb-0">
                                <i class="fas fa-list me-2"></i>Transacciones Recientes
                            </h6>
                            <div class="d-flex gap-2">
                                <button class="btn btn-sm btn-outline-primary" onclick="refreshTransactions()">
                                    <i class="fas fa-sync-alt me-1"></i>Actualizar
                                </button>
                                <button class="btn btn-sm btn-success" onclick="showAddTransactionModal()">
                                    <i class="fas fa-plus me-1"></i>Nueva Transacci√≥n
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <!-- Loading State -->
                            <div class="loading-spinner" id="transactionsLoading">
                                <i class="fas fa-spinner fa-spin fa-2x text-primary"></i>
                                <p class="mt-2">Cargando transacciones...</p>
                            </div>

                            <!-- Empty State -->
                            <div class="empty-state" id="emptyState" style="display: none;">
                                <i class="fas fa-inbox fa-3x mb-3"></i>
                                <p>No hay transacciones registradas</p>
                                <button class="btn btn-outline-primary" onclick="showAddTransactionModal()">
                                    <i class="fas fa-plus me-2"></i>Agregar Primera Transacci√≥n
                                </button>
                            </div>

                            <!-- Transactions Table -->
                            <div class="table-responsive" id="transactionsTable" style="display: none;">
                                <table class="table table-dark table-hover">
                                    <thead>
                                        <tr>
                                            <th><i class="fas fa-calendar-alt me-1"></i>Fecha</th>
                                            <th><i class="fas fa-receipt me-1"></i>Concepto</th>
                                            <th><i class="fas fa-user me-1"></i>Socio</th>
                                            <th><i class="fas fa-building me-1"></i>Empresa</th>
                                            <th><i class="fas fa-tags me-1"></i>Tipo</th>
                                            <th><i class="fas fa-dollar-sign me-1"></i>Total</th>
                                            <th><i class="fas fa-cogs me-1"></i>Acciones</th>
                                        </tr>
                                    </thead>
                                    <tbody id="transactionsBody">
                                        <!-- Se llenar√°n din√°micamente -->
                                    </tbody>
                                </table>
                                
                                <!-- Pagination -->
                                <nav aria-label="Paginaci√≥n de transacciones" class="mt-3">
                                    <ul class="pagination justify-content-center" id="pagination">
                                        <!-- Se generar√° din√°micamente -->
                                    </ul>
                                </nav>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Transaction Modal -->
        <div class="modal fade" id="addTransactionModal" tabindex="-1" data-bs-backdrop="static">
            <div class="modal-dialog modal-lg">
                <div class="modal-content" style="background: rgba(25, 28, 36, 0.95); border: 1px solid rgba(255, 255, 255, 0.1);">
                    <div class="modal-header">
                        <h5 class="modal-title text-white">
                            <i class="fas fa-plus-circle me-2"></i>Nueva Transacci√≥n
                        </h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                    </div>
                    <div class="modal-body">
                        <form id="addTransactionForm">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="transactionDate" class="form-label">
                                        <i class="fas fa-calendar me-1"></i>Fecha
                                    </label>
                                    <input type="date" class="form-control" id="transactionDate" required>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="transactionType" class="form-label">
                                        <i class="fas fa-exchange-alt me-1"></i>Tipo
                                    </label>
                                    <select class="form-select" id="transactionType" required onchange="updateTransactionTypeStyle()">
                                        <option value="">Seleccionar tipo...</option>
                                        <option value="I">üí∞ Ingreso</option>
                                        <option value="G">üí∏ Gasto</option>
                                    </select>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label for="transactionConcept" class="form-label">
                                    <i class="fas fa-file-alt me-1"></i>Concepto
                                </label>
                                <input type="text" class="form-control" id="transactionConcept" 
                                       placeholder="Descripci√≥n de la transacci√≥n" required maxlength="500">
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="transactionPartner" class="form-label">
                                        <i class="fas fa-user me-1"></i>Socio
                                    </label>
                                    <select class="form-select" id="transactionPartner" required>
                                        <option value="">Seleccionar socio...</option>
                                        <optgroup label="Socios">
                                            <option value="Marco Delgado">Marco Delgado</option>
                                            <option value="Antonio Razo">Antonio Razo</option>
                                            <option value="Escuela">Escuela</option>
                                        </optgroup>
                                        <optgroup label="Maestros RockstarSkull">
                                            <option value="Hugo Vazquez">Hugo Vazquez</option>
                                            <option value="Julio Olvera">Julio Olvera</option>
                                            <option value="Demian Andrade">Demian Andrade</option>
                                            <option value="Irwin Hernandez">Irwin Hernandez</option>
                                            <option value="Nahomy Perez">Nahomy Perez</option>
                                            <option value="Luis Blanquet">Luis Blanquet</option>
                                            <option value="Manuel Reyes">Manuel Reyes</option>
                                            <option value="Harim Lopez">Harim Lopez</option>
                                        </optgroup>
                                        <optgroup label="Empresas">
                                            <option value="Symbiot Technologies">Symbiot Technologies</option>
                                            <option value="Rockstar Skull">Rockstar Skull</option>
                                        </optgroup>
                                    </select>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="transactionCompany" class="form-label">
                                        <i class="fas fa-building me-1"></i>Empresa
                                    </label>
                                    <select class="form-select" id="transactionCompany" required>
                                        <option value="">Seleccionar empresa...</option>
                                        <option value="1">üé∏ Rockstar Skull</option>
                                        <option value="2">üöÄ Symbiot Technologies</option>
                                    </select>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-4 mb-3">
                                    <label for="transactionPayment" class="form-label">
                                        <i class="fas fa-credit-card me-1"></i>Forma de Pago
                                    </label>
                                    <select class="form-select" id="transactionPayment" required>
                                        <option value="">Seleccionar...</option>
                                        <option value="Transferencia">üè¶ Transferencia</option>
                                        <option value="Efectivo">üíµ Efectivo</option>
                                        <option value="TPV">üì± TPV</option>
                                        <option value="TPV Domiciliado">üì± TPV Domiciliado</option>
                                    </select>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="transactionQuantity" class="form-label">
                                        <i class="fas fa-hashtag me-1"></i>Cantidad
                                    </label>
                                    <input type="number" class="form-control" id="transactionQuantity" 
                                           min="1" step="1" value="1" required onchange="calculateTotal()">
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="transactionUnitPrice" class="form-label">
                                        <i class="fas fa-dollar-sign me-1"></i>Precio Unitario
                                    </label>
                                    <input type="number" class="form-control" id="transactionUnitPrice" 
                                           min="0" step="0.01" placeholder="0.00" required onchange="calculateTotal()">
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-8 mb-3">
                                    <div class="alert alert-info">
                                        <small>
                                            <i class="fas fa-info-circle me-1"></i>
                                            El total se calcula autom√°ticamente: Cantidad √ó Precio Unitario
                                        </small>
                                    </div>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="transactionTotal" class="form-label">
                                        <i class="fas fa-calculator me-1"></i>Total
                                    </label>
                                    <input type="text" class="form-control" id="transactionTotal" 
                                           placeholder="$0.00" readonly style="background-color: rgba(255,255,255,0.05);">
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" id="deleteTransactionBtn" class="btn btn-danger me-auto" style="display: none;">
                            <i class="fas fa-trash me-1"></i>Eliminar
                        </button>
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                            <i class="fas fa-times me-1"></i>Cancelar
                        </button>
                        <button type="button" class="btn btn-primary" onclick="submitTransaction()">
                            <i class="fas fa-save me-1"></i>Guardar Transacci√≥n
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- TODOS LOS MODALES DE ALUMNOS SE CARGAR√ÅN DIN√ÅMICAMENTE -->
        <!-- Modal Editar Alumno -->
        <div class="modal fade" id="editStudentModal" tabindex="-1">
            <!-- Contenido del modal se carga din√°micamente -->
        </div>

        <!-- Modal Nuevo Alumno -->
        <div class="modal fade" id="addStudentModal" tabindex="-1">
            <!-- Contenido del modal se carga din√°micamente -->
        </div>

        <!-- Modal Detalle de Alumno -->
        <div class="modal fade" id="studentDetailModal" tabindex="-1">
            <!-- Contenido del modal se carga din√°micamente -->
        </div>

        <!-- Modal Detalle de Sensor -->
        <div class="modal fade" id="sensorDetailModal" tabindex="-1" aria-labelledby="sensorDetailModalLabel" aria-hidden="true">
            <!-- Contenido del modal se carga din√°micamente -->
        </div>

        <!-- Modal Detalle de Cliente Symbiot -->
        <div class="modal fade" id="clienteSymbiotDetailModal" tabindex="-1" aria-labelledby="clienteSymbiotDetailModalLabel" aria-hidden="true">
            <!-- Contenido del modal se carga din√°micamente -->
        </div>

        <!-- Modal Historial de Pagos -->
        <div class="modal fade" id="paymentHistoryModal" tabindex="-1">
            <!-- Contenido del modal se carga din√°micamente -->
        </div>

    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Chart.js para gr√°ficos -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Theme Toggle - Cargar temprano para evitar flash -->
    <script src="js/theme-toggle.js?v=1.0.1"></script>

    <!-- API Client v3.1.3 - Universal API Handler (DEBE CARGARSE PRIMERO) -->
    <script src="assets/js/api-client.js?v=3.1.3"></script>

    <!-- JAVASCRIPT MODULAR - ORDEN DE CARGA CR√çTICO -->
    <script src="js/dashboard-core.js?v=3.4.0"></script>           <!-- v3.4.0: Fix formatDate UTC desfase + homologar formas de pago -->
    <script src="js/dashboard-auth.js?v=3.1.3"></script>           <!-- v3.1.3: Rutas din√°micas buildPageUrl -->
    <script src="js/dashboard-api.js?v=3.1.3"></script>            <!-- v3.1.3: Rutas din√°micas buildPageUrl -->
    <script src="js/dashboard-stats.js?v=3.3.0"></script>          <!-- v3.3.0: parseLocalDate helper, fix timezone UTC en fechas -->
    <script src="js/dashboard-payments.js?v=3.4.0"></script>       <!-- v3.4.0: Fix getNextPaymentDate UTC desfase -->
    <script src="js/dashboard-transactions.js?v=3.4.0"></script>   <!-- v3.4.0: Cache-bust para formatDate corregido -->
    <script src="js/dashboard-modals.js?v=3.4.0"></script>         <!-- v3.4.0: Homologar formas de pago + scroll preserve -->
    <script src="js/dashboard-students.js?v=3.4.0"></script>       <!-- v3.4.0: Fix UTC desfase en pagos y fecha inscripci√≥n -->
    <script src="js/dashboard-horarios.js?v=1.0.0"></script>       <!-- v1.0.0: Pesta√±a Horarios Disponibles por sal√≥n -->
    <script src="js/dashboard-symbiot.js?v=1.0.0"></script>        <!-- v1.0.0: Widgets Symbiot Technologies IoT -->
    <script src="js/user-permissions.js?v=1.2.0"></script>        <!-- v1.1.0: Permisos por p√°gina y navegaci√≥n -->
    <script>if (typeof window.checkPageAccess === 'function') window.checkPageAccess();</script>
    <script src="js/dashboard-init.js?v=3.4.0"></script>           <!-- v3.4.0: Scroll preserve en visibility change -->
    <script src="js/notifications.js?v=1.0.1"></script>

</body>
</html>